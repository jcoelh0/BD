CREATE SCHEMA  PRESCRI큐O_MEDICAMENTOS
go


CREATE TABLE PRESCRI큐O_MEDICAMENTOS.MEDICO (
	n_medico		INT,
	nome			VARCHAR(30) NOT NULL,
	especialidade	VARCHAR(30),
	PRIMARY KEY(n_medico)
);


CREATE TABLE PRESCRI큐O_MEDICAMENTOS.PACIENTE (
	n_utente			INT,
	nome				VARCHAR(30) NOT NULL,
	data_nascimento		DATE NOT NULL,
	endere每			VARCHAR(30),
	PRIMARY KEY(n_utente)
);


CREATE TABLE PRESCRI큐O_MEDICAMENTOS.FARMACIA (
	nome		VARCHAR(30) NOT NULL,
	endere每	VARCHAR(30),
	telefone	INT,
	PRIMARY KEY(nome)
);

CREATE TABLE PRESCRI큐O_MEDICAMENTOS.PRESCRI큐O (
	n_prescricao	INT,
	n_medico		INT,
	n_utente		INT,
	data_presc		DATE,
	nome_farmacia	VARCHAR(30),
	PRIMARY KEY(n_prescricao),
	FOREIGN KEY(n_medico) REFERENCES PRESCRI큐O_MEDICAMENTOS.MEDICO(n_medico),
	FOREIGN KEY(n_utente) REFERENCES PRESCRI큐O_MEDICAMENTOS.PACIENTE(n_utente),
	FOREIGN KEY(nome_farmacia) REFERENCES PRESCRI큐O_MEDICAMENTOS.FARMACIA(nome)
);
/*
ALTER TABLE PRESCRI큐O_MEDICAMENTOS.PRESCRI큐O
ALTER COLUMN data_presc DATE;
*/
CREATE TABLE PRESCRI큐O_MEDICAMENTOS.FARMACEUTICA (
	n_registo	INT,
	nome		VARCHAR(50) NOT NULL,
	endereco	VARCHAR(100) NOT NULL,
	PRIMARY KEY(n_registo),
);
/*
DROP TABLE PRESCRI큐O_MEDICAMENTOS.FARMACEUTICA;

ALTER TABLE PRESCRI큐O_MEDICAMENTOS.FARMACEUTICA
ALTER COLUMN endereco VARCHAR (100) NOT NULL;
*/
CREATE TABLE PRESCRI큐O_MEDICAMENTOS.FARMACO (
	nome_comercial	VARCHAR(150) NOT NULL,
	formula			VARCHAR(30),
	n_registo_farm	INT,
	PRIMARY KEY(n_registo_farm, nome_comercial),
	FOREIGN KEY(n_registo_farm) REFERENCES PRESCRI큐O_MEDICAMENTOS.FARMACEUTICA(n_registo)
);
/*
 SELECT name AS 'Foreign Key Constraint Name', 
	       OBJECT_SCHEMA_NAME(parent_object_id) + '.' + OBJECT_NAME(parent_object_id) AS 'Child Table'
   FROM sys.foreign_keys 
   WHERE OBJECT_SCHEMA_NAME(referenced_object_id) = 'PRESCRI큐O_MEDICAMENTOS' AND 
              OBJECT_NAME(referenced_object_id) = 'FARMACEUTICA';
ALTER TABLE PRESCRI큐O_MEDICAMENTOS.FARMACO 
ALTER COLUMN nome_comercial VARCHAR(150) NOT NULL;
ALTER TABLE PRESCRI큐O_MEDICAMENTOS.FARMACO DROP CONSTRAINT FK__FARMACO__nome_co__59C55456;
DROP TABLE PRESCRI큐O_MEDICAMENTOS.CONTEM;
DROP TABLE PRESCRI큐O_MEDICAMENTOS.FARMACO;
*/

CREATE TABLE PRESCRI큐O_MEDICAMENTOS.CONTEM (
	n_prescricao	INT,
	n_registo		INT,
	nome_comercial	VARCHAR(150),
	PRIMARY KEY(n_prescricao, n_registo, nome_comercial),
	FOREIGN KEY(n_prescricao) REFERENCES PRESCRI큐O_MEDICAMENTOS.PRESCRI큐O(n_prescricao),
	FOREIGN KEY(n_registo, nome_comercial) 
	REFERENCES PRESCRI큐O_MEDICAMENTOS.FARMACO(n_registo_farm, nome_comercial)
);
